@{
    ViewData["Title"] = "Place Order";
}

<div class="container mt-4">

    <h2 class="mb-4">Place Purchase Order</h2>

    <form asp-action="OrderDrug" method="post">

        <!-- Supplier -->
        <div class="mb-3">
            <label class="form-label">Select Supplier</label>
            <select name="SupplierId" class="form-control" required>
                <option value="">-- Select Supplier --</option>
                @foreach (var s in ViewBag.Suppliers)
                {
                    <option value="@s.SupplierId">@s.SupplierName</option>
                }
            </select>
        </div>

        <hr />

        <h5>Add Medicines</h5>

        <div id="items-container">

            <div class="row mb-3 item-row">

                <div class="col-md-6">
                    <select name="DrugIds" class="form-control" required>
                        <option value="">-- Select Drug --</option>
                        @foreach (var d in ViewBag.Drugs)
                        {
                            <option value="@d.DrugId">
                                @d.DrugTitle
                            </option>
                        }
                    </select>
                </div>

                <div class="col-md-4">
                    <input type="number"
                           name="Quantities"
                           class="form-control"
                           placeholder="Quantity"
                           min="1"
                           required />
                </div>

                <div class="col-md-2">
                    <button type="button"
                            class="btn btn-danger remove-btn">
                        X
                    </button>
                </div>

            </div>

        </div>

        <button type="button"
                class="btn btn-secondary mb-3"
                id="add-item">
            + Add Another Medicine
        </button>

        <br />

        <button type="submit"
                class="btn btn-success">
            Submit Order
        </button>

    </form>

</div>

<script>
    document.getElementById("add-item").addEventListener("click", function () {

        var container = document.getElementById("items-container");
        var firstRow = document.querySelector(".item-row");
        var newRow = firstRow.cloneNode(true);

        newRow.querySelectorAll("input").forEach(input => input.value = "");
        newRow.querySelectorAll("select").forEach(select => select.selectedIndex = 0);

        container.appendChild(newRow);
    });

    document.addEventListener("click", function (e) {
        if (e.target.classList.contains("remove-btn")) {
            var rows = document.querySelectorAll(".item-row");
            if (rows.length > 1) {
                e.target.closest(".item-row").remove();
            }
        }
    });
</script>
